PHP implementation of the Corona-Warn-App (CWA) Event Registration
===================================================================
This is an implementation of the Protocol used to generate event and location QR codes for the Corona-Warn-App (CWA) as described in [
Corona-Warn-App: Documentation – Event Registration - Summary](https://github.com/corona-warn-app/cwa-documentation/blob/master/event_registration.md).

**This is not an official implementation – use it at your own risk** (as far as that's possible, these days…).

State
-----
The interface works pretty well for generating the cwaPayload and a link to the CWA. For the use of the QR-Code your application must be whitelisted by CWA.

Prequisites
-----------
Install protobuf for PHP as described and activate the static module in your PHP.ini.
[See in protobuf repository](https://github.com/protocolbuffers/protobuf/tree/master/php).

Actual PHP classes generated by protobuf for PHP 7.4 are in the classes folder.

For other PHP versions generate PHP Classes out of the cwa.proto into the classes folder:

```sh
protoc --php_out=classes/cwaproto cwa.proto
```

Usage of Class
--------------
```php
<?php
// include CWA Proto Classes
require "classes/cwaproto/GPBMetadata/Cwa/Cwa.php";
require "classes/cwaproto/TraceLocation.php";
require "classes/cwaproto/CWALocationData.php";
require "classes/cwaproto/CrowdNotifierData.php";
require "classes/cwaproto/QRCodePayload.php";
// include project class
require "classes/Cwaeventqr.php";

// on initialize class a new seed is generated but can overwritten!
$cwa = new Cwaeventqr();

// optional to generate payload for same location with no changes!
$cwa->setSeed("vsInOk7pHigPO4K8juZLPg=="); // base64 encoded random_bytes(16) output

// Mandatory
$cwa->TraceLocation->setDescription("Test Restaurant"); // max 100 characters
$cwa->TraceLocation->setAddress("Potsdamer Platz 1, 10785 Berlin, Deutschland"); // max 100 characters

// optional for Events
// $cwa->TraceLocation->setStartTimestamp(1638486000); // unix time stamp
// $cwa->TraceLocation->setEndTimestamp(1638572399); // unix time stamp

// mandatory
$cwa->CWALocationData->setType(4); // use ID that fits, see "CWA types" list below
$cwa->CWALocationData->setDefaultCheckInLengthInMinutes(2*60); // average checkin length in minutes

// create the payload
$cwa->createPayload(); // just creation of the payload

// get the payload
$cwa->getPayload(); // base64 encoded payload

// get seed for later payload generation
$seed = $cwa->getSeed();
echo "Seed: $seed<br><br>";

// get CWA link
$link = $cwa->getCwaLink(); // link to CWA with payload for Location Event

echo '<a href="'.$link.'">Test Link</a>';

```

CWA Types
-------------------
```php
LOCATION_TYPE_UNSPECIFIED = 0;
LOCATION_TYPE_PERMANENT_OTHER = 1;
LOCATION_TYPE_TEMPORARY_OTHER = 2;
LOCATION_TYPE_PERMANENT_RETAIL = 3;
LOCATION_TYPE_PERMANENT_FOOD_SERVICE = 4;
LOCATION_TYPE_PERMANENT_CRAFT = 5;
LOCATION_TYPE_PERMANENT_WORKPLACE = 6;
LOCATION_TYPE_PERMANENT_EDUCATIONAL_INSTITUTION = 7;
LOCATION_TYPE_PERMANENT_PUBLIC_BUILDING = 8;
LOCATION_TYPE_TEMPORARY_CULTURAL_EVENT = 9;
LOCATION_TYPE_TEMPORARY_CLUB_ACTIVITY = 10;
LOCATION_TYPE_TEMPORARY_PRIVATE_EVENT = 11;
LOCATION_TYPE_TEMPORARY_WORSHIP_SERVICE = 12;
```
CWA QR-Code  
-------------------
For creation of QR-Code you may use any QR-Code creator.
We had problems to get it work using a QR-Code.

The payload is also usable in any event tracing app. But your app must bee whitelisted by SAP.

[More information in the CWA Documentation – Event Registration - Summary](https://github.com/corona-warn-app/cwa-documentation/blob/master/event_registration.md)